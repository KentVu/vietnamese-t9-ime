apply plugin: 'java-library'
apply plugin: 'kotlin'

test {
    systemProperty "java.library.path", file("${project(":dawg-jni").buildDir}/lib/main/debug").absolutePath
    // For TrieTest.kt
    //systemProperty "word_list_file", "$rootDir/data/vi-DauMoi.dic"
    useJUnitPlatform()
    testLogging {
        events "passed", "skipped", "failed"
        exceptionFormat "full"
    }
}

dependencies {
    implementation fileTree(dir: 'libs', include: ['*.jar'])
    implementation project(':dawg-java')  // remember to enable dawg-java & executeSwig below
    //implementation "kentvu.dawgjava:dawg-java:$dawgjava_version"  // remember to set personal token to fetch
    implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk8:$kotlin_version"
    implementation "org.jetbrains.kotlinx:kotlinx-coroutines-core:$coroutines_version"

    // Required for local unit tests (JUnit 4 framework)
    testImplementation "io.mockk:mockk:$mockk_version"
    testImplementation "io.kotest:kotest-runner-junit5-jvm:$kotest_version"
    testImplementation "io.kotest:kotest-assertions-core-jvm:$kotest_version"
}

//tasks.withType(KotlinCompile).configureEach
compileKotlin {
    dependsOn ':dawg-jni:linkDebug' // -> executeSwig
    kotlinOptions {
        jvmTarget = "1.8"
    }
}

compileTestKotlin {
    kotlinOptions {
        jvmTarget = "1.8"
        freeCompilerArgs = freeCompilerArgs + "-Xopt-in=kotlin.RequiresOptIn"
    }
}


java {
    sourceCompatibility = JavaVersion.VERSION_1_8
    targetCompatibility = JavaVersion.VERSION_1_8
}